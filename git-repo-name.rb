# frozen_string_literal: true

# This file was generated by https://github.com/petrgazarov/git-repo-name/blob/main/.github/workflows/release_packages.yml
class GitRepoName < Formula
  desc "CLI tool to sync local git directory name with remote repository name"
  homepage "https://github.com/petrgazarov/git-repo-name"
  version "0.1.8"
  license "MIT"
  
  resource "shell_script" do
    url "https://github.com/petrgazarov/git-repo-name/releases/download/0.1.8/git-repo-name.sh"
    version "0.1.8"
    sha256 "a7381aec3bd23d9687790cac3a3fd30127139748082b6e6bac4d076a05f1657e"
  end

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/petrgazarov/git-repo-name/releases/download/0.1.8/git-repo-name-0.1.8-x86_64-apple-darwin"
      sha256 "2f975104c2a11f8f944d02df9ba74b98095b0ad246119f2d1dc3f2310aa73f54"
    end

    if Hardware::CPU.arm?
      url "https://github.com/petrgazarov/git-repo-name/releases/download/0.1.8/git-repo-name-0.1.8-aarch64-apple-darwin"
      sha256 "fb644857db050078e37e1beb547fe7cf0cda1de6b81d5d6396852ecc071db917"
    end

    def install
      if Hardware::CPU.intel?
        filename = File.basename("https://github.com/petrgazarov/git-repo-name/releases/download/0.1.8/git-repo-name-0.1.8-x86_64-apple-darwin")
        bin.install filename => "git-repo-name-bin"
      end

      if Hardware::CPU.arm?
        filename = File.basename("https://github.com/petrgazarov/git-repo-name/releases/download/0.1.8/git-repo-name-0.1.8-aarch64-apple-darwin")
        bin.install filename => "git-repo-name-bin"
      end
      
      # Install shell script resource
      resource("shell_script").stage do
        (share/"git-repo-name").install "git-repo-name.sh"
      end
      
      # Install the shell wrapper
      (bin/"git-repo-name").write <<~EOS
        #!/bin/sh
        # This shell script wrapper handles directory changes when using git-repo-name
        exec /bin/sh "#{share}/git-repo-name/git-repo-name.sh" "$@"
      EOS
      
      chmod 0755, bin/"git-repo-name"
    end

    def caveats
      <<~EOS
        Add the following line to your shell profile (such as ~/.bashrc or ~/.zshrc):

          source "$(brew --prefix)/share/git-repo-name/git-repo-name.sh"
      EOS
    end
  end

  on_linux do
    if Hardware::CPU.arm? && Hardware::CPU.is_64_bit?
      url "https://github.com/petrgazarov/git-repo-name/releases/download/0.1.8/git-repo-name-0.1.8-aarch64-unknown-linux-gnu"
      sha256 "428a70e6017489f700278ee2bfab39f0595e55d90ab4747c816e3d27670bc3e7"
    end

    if Hardware::CPU.intel?
      url "https://github.com/petrgazarov/git-repo-name/releases/download/0.1.8/git-repo-name-0.1.8-x86_64-unknown-linux-gnu"
      sha256 "9b8f923c1adb0218bbe0f6ff768c461fc83e46d03082c6aafc5fc01b5b4e7bdc"
    end

    def install
      if Hardware::CPU.arm? && Hardware::CPU.is_64_bit?
        filename = File.basename("https://github.com/petrgazarov/git-repo-name/releases/download/0.1.8/git-repo-name-0.1.8-aarch64-unknown-linux-gnu")
        bin.install filename => "git-repo-name-bin"
      end

      if Hardware::CPU.intel?
        filename = File.basename("https://github.com/petrgazarov/git-repo-name/releases/download/0.1.8/git-repo-name-0.1.8-x86_64-unknown-linux-gnu")
        bin.install filename => "git-repo-name-bin"
      end
      
      # Install shell script resource
      resource("shell_script").stage do
        (share/"git-repo-name").install "git-repo-name.sh"
      end
      
      # Install the shell wrapper
      (bin/"git-repo-name").write <<~EOS
        #!/bin/sh
        # This shell script wrapper handles directory changes when using git-repo-name
        exec /bin/sh "#{share}/git-repo-name/git-repo-name.sh" "$@"
      EOS
      
      chmod 0755, bin/"git-repo-name"
    end

    def caveats
      <<~EOS
        Add the following line to your shell profile (such as ~/.bashrc or ~/.zshrc):

          source "$(brew --prefix)/share/git-repo-name/git-repo-name.sh"
      EOS
    end
  end

  test do
    system "#{bin}/git-repo-name", "--version"
  end
end 